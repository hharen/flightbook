<p style="color: green"><%= notice %></p>

<% content_for :title, "Instructors" %>

<div class="user-filter-section">
  <h1>Instructors</h1>

  <div class="action-buttons">
    <%= link_to "New instructor", new_instructor_path, class: "btn btn-primary" %>
  </div>

  <div class="filter-controls">
    <%= form_with url: instructors_path, method: :get, local: true, class: "user-filter-form" do |form| %>
      <%= form.select :user_id,
          options_from_collection_for_select(@users, :id, :name, @selected_user&.id),
          { prompt: "All users" },
          { class: "form-select", onchange: "this.form.submit();" }
      %>
    <% end %>

    <% if @selected_user %>
      <div class="filter-info">
        Showing stats for: <strong><%= @selected_user.name %></strong>
      </div>
    <% else %>
      <div class="filter-info">
        Showing stats for all users
      </div>
    <% end %>
  </div>
</div>

<div class="table-container">
  <table class="data-table">
    <thead>
      <tr>
        <th>Name</th>
        <th>Flying sessions</th>
        <th>Flight time</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <% @instructors.each do |instructor| %>
        <% stats = @instructor_stats[instructor.id] %>
        <tr>
          <td><%= link_to instructor.name, edit_instructor_path(instructor) %></td>
          <td><%= stats[:sessions_count] %></td>
          <td>
            <% minutes = stats[:flight_time] %>
            <% if minutes > 0 %>
              <%= (minutes / 60.0).round(1) %> hours (<%= minutes %> min)
            <% else %>
              -
            <% end %>
          </td>
          <td class="actions">
            <%= link_to "Delete", instructor_path(instructor),
                        data: { "turbo-method": :delete },
                        class: "btn btn-small btn-danger" %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>
