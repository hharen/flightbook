<p style="color: green"><%= notice %></p>

<% content_for :title, "Flights" %>

<h1>Flights</h1>

<div class="filter-controls">
  <%= form_with url: flights_path, method: :get, local: true do |form| %>
    <%= form.select :user_id, 
        options_from_collection_for_select(@users, :id, :name, params[:user_id]), 
        { prompt: "All users" }, 
        { onchange: "this.form.submit();" } %>
  <% end %>
  
  <% if @selected_user %>
    <p>Showing flights for: <strong><%= @selected_user.name %></strong></p>
  <% else %>
    <p>Showing flights for all users</p>
  <% end %>
</div>

<div class="table-container">
  <table class="data-table">
    <thead>
      <tr>
        <th>Duration</th>
        <th>Flying Session</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <% @flights.each do |flight| %>
        <tr>
          <td><%= flight.duration %> min</td>
          <td>
            <% if flight.flying_session %>
              <div>
                <%= link_to flying_session_path(flight.flying_session) do %>
                  <strong><%= flight.flying_session.date_time.strftime("%B %d, %Y at %I:%M %p") %></strong>
                <% end %>
              </div>
              <% if flight.flying_session.instructor %>
                <div class="text-muted">
                  Instructor: <%= flight.flying_session.instructor.name %>
                </div>
              <% else %>
                <div class="text-muted">
                  No instructor assigned
                </div>
              <% end %>
            <% else %>
              No session
            <% end %>
          </td>
          <td class="actions">
            <%= link_to "Edit", edit_flight_path(flight), class: "btn btn-small" %>
            <%= link_to "Delete", flight_path(flight), method: :delete, 
                        confirm: "Are you sure?", class: "btn btn-small btn-danger" %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>

<%= link_to "New flight", new_flight_path %>
