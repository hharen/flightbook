<p style="color: green"><%= notice %></p>

<% content_for :title, "Flights" %>

<h1>Flights</h1>

<div class="filter-controls">
  <%= form_with url: flights_path, method: :get, local: true, class: "user-filter-form" do |form| %>
    <%= form.select :user_id,
        options_from_collection_for_select(@users, :id, :name, @selected_user&.id),
        { prompt: "All users" },
        { class: "form-select", onchange: "this.form.submit();" }
    %>
  <% end %>
  
  <% if @selected_user %>
    <div class="filter-info">
      Showing flights for: <strong><%= @selected_user.name %></strong>
      (<%= pluralize(@flights.count, 'flight') %>)
      <% if @total_flight_time && @total_flight_time > 0 %>
        <br>
        Total flight time: <strong><%= (@total_flight_time / 60.0).round(1) %> hours</strong> 
        (<%= @total_flight_time %> minutes)
      <% end %>
    </div>
  <% else %>
    <div class="filter-info">
      Showing all flights (<%= pluralize(@flights.count, 'flight') %>)
    </div>
  <% end %>
</div>

<div class="table-container">
  <table class="data-table">
    <thead>
      <tr>
        <th>Flight #</th>
        <th>Flying Session</th>
        <th>Note</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <% @flights.each do |flight| %>
        <%= render 'flight_row', flight: flight %>
      <% end %>
    </tbody>
  </table>
</div>

<%= link_to "New flight", new_flight_path %>
